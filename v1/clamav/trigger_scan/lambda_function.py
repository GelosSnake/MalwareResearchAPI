import json
import boto3
from botocore.vendored import requests

sns_clamav_scan_arn_name = ''
def return_code(status, body):
    return {"statusCode": status,"body": json.dumps(body)}

client = boto3.client('sns')

def lambda_handler(event, context):
    try:
        if event['pathParameters'] and event['pathParameters']['proxy']:
            sha256 = event['pathParameters']['proxy']
            sha256 = sha256.lower()
            response = client.publish(TargetArn=sns_clamav_scan_arn_name, Message=sha256)
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                    return return_code(200,"Clamav scan initiated.")
            else:
                return return_code(501,"Internal server error")
        else:
            return return_code(400, 'sha256 param must be present.')
                    
    except Exception as E:
        print(E)
        return return_code(501, 'Internal server error')